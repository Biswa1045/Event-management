<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Management</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }

    .toolbar {
      position: absolute;
      top: 20px; /* Adjust top margin */
      left: 20px; /* Adjust left margin */
      right: 20px; /* Adjust right margin */
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-radius: 10px; 
      background-color: rgba(0, 0, 0, 0.7);
      color: #fff;
      z-index: 1; /* Ensure the toolbar stays above the hero image */
    }

    .toolbar h1 {
      margin: 0;
      font-size: 24px;
    }

    .toolbar .auth {
      display: flex;
      align-items: center;
      position: relative;
      font-size: 16px;
    }
    
    .toolbar .auth a {
      margin-right: 15px;
      color: #fff;
      text-decoration: none;
    }

    .toolbar .auth span {
      margin-right: 15px;
    }

    .toolbar .profile-pic {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
      cursor: pointer;
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      top: 50px; /* Position below the toolbar */
      right: 0;
      background-color: #050505;
      color: #000;
      border: 1px solid #ccc;
      border-radius: 5px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .dropdown-menu a {
      display: block;
      padding: 10px;
      color: #000;
      text-decoration: none;
    }

    .dropdown-menu a:hover {
      background-color: #f0f0f050;
    }

    .hero {
      background-image: url('https://i.ytimg.com/vi/eVDPDSepQGU/maxresdefault.jpg');
      background-size: cover;
      height: 500px;
      display: flex;
      width: 100%;
      justify-content: center;
      align-items: center;
      color: #fff;
      text-align: center;
      position: relative;
    }

    .hero h2 {
      font-size: 36px;
      margin: 0;
    }

    .search-bar {
      padding: 20px;
      background-color: #f0f0f0;
      text-align: center;
      position: relative;
      z-index: 1; /* Ensure the search bar stays above the hero image */
    }

    .search-bar input[type="text"] {
      width: 50%;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    #category-filter {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .filter-button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background-color: #007bff;
      color: #fff;
      cursor: pointer;
    }

    .filter-button.active {
      background-color: #0056b3;
    }

    #event-list {
      display: flex;
      flex-wrap: wrap;
      gap: 20px; /* Adjust gap between cards as needed */
    }

    .event-card {
      border: 1px solid #ddd;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background-color: #fff;
      display: flex;
      flex-direction: column;
      width: calc(33.333% - 20px); /* Adjust width and margin for 3 cards per row */
      margin-bottom: 20px;
    }

    .event-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .event-card-content {
      padding: 15px;
      flex: 1;
    }

    .event-card-content h3 {
      margin: 0 0 10px;
    }

    .event-card-content p {
      margin: 0 0 10px;
      color: #555;
    }

    .event-card-content p.price {
      color: #007bff;
      font-weight: bold;
    }
  </style>
</head>
<body>

<!-- Toolbar -->
<div class="toolbar">
  <h1>EventManage</h1>
  <div class="auth" id="auth">
    <a href="/auth/login.html">Sign In</a> / <a href="/auth/register.html">Register</a>
  </div>
</div>

<!-- Hero section -->
<div class="hero">
  <h2>Welcome to Event Management</h2>
</div>

<!-- Search bar -->
<div class="search-bar">
  <input type="text" id="search-input" placeholder="Search events...">
  <div id="category-filter">
    <button class="filter-button active" data-category="all">All</button>
    <button class="filter-button" data-category="Sports">Sports</button>
    <button class="filter-button" data-category="Tech">Tech</button>
    <button class="filter-button" data-category="Music">Music</button>
  </div>
</div>

<!-- Event list -->
<div class="event-list" id="event-list">
  <!-- Events will be dynamically inserted here -->
</div>

<!-- Footer -->
<footer style="background-color: #333; color: #fff; padding: 20px 0; text-align: center; position: relative; z-index: 1;">
  <div style="display: flex; justify-content: space-around; flex-wrap: wrap; padding: 20px;">
    <div style="flex: 1; min-width: 200px; margin-bottom: 20px;">
      <h3 style="margin-top: 0;">About Us</h3>
      <p>This is an Event Management website assessment for Hyscalar by Biswajit Sahu.</p>
    </div>
    <div style="flex: 1; min-width: 200px; margin-bottom: 20px;">
      <h3 style="margin-top: 0;">Quick Links</h3>
      <ul style="list-style-type: none; padding: 0;">
        <li><a href="#" style="color: #fff; text-decoration: none;">Home</a></li>
        <li><a href="#" style="color: #fff; text-decoration: none;">Events</a></li>
        <li><a href="#" style="color: #fff; text-decoration: none;">About</a></li>
        <li><a href="#" style="color: #fff; text-decoration: none;">Contact</a></li>
      </ul>
    </div>
    <div style="flex: 1; min-width: 200px; margin-bottom: 20px;">
      <h3 style="margin-top: 0;">Contact Us</h3>
      <p>Email: biswajitsahu1045@gmail.com</p>
      <p>Phone: +91 7205550528</p>
    </div>
  </div>
  <div style="background-color: #222; padding: 10px 0;">
    <p style="margin: 0;">&copy; 2024 EventManage. All rights reserved.</p>
  </div>
</footer>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const displayEvents = (events) => {
      const eventList = document.getElementById('event-list');
      eventList.innerHTML = '';

      const categoryImages = {
        'Literary': 'assets/Literary.jpg',
        'Music': 'assets/Music.jpg',
        'Sports': 'assets/Sports.jpg',
        'Tech': 'assets/Tech.jpg'
      };

      events.forEach(event => {
  const eventElement = document.createElement('div');
  eventElement.className = 'event-card';
  eventElement.addEventListener('click', () => {
    window.location.href = `/eventDetails/eventDetails.html?id=${event.id}`;
  });
  const eventImage = document.createElement('img');
  const imageSrc = categoryImages[event.category] || 'assets/Tech.jpg'; // Use a default image if the category doesn't match
  eventImage.src = imageSrc;
  eventImage.alt = `${event.category}`;

  const eventContent = document.createElement('div');
  eventContent.className = 'event-card-content';

  // Format event date and time
  const eventDateTime = new Date(event.event_time);
  const formattedDate = eventDateTime.toLocaleDateString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
  const formattedTime = eventDateTime.toLocaleTimeString('en-US', {
    hour: 'numeric',
    minute: 'numeric',
    hour12: true
  });

  eventContent.innerHTML = `
    <h3>${event.event_name}</h3>
    <p>Date: ${formattedDate}</p>
    <p>Time: ${formattedTime}</p>
    <p>${event.event_location}</p>
    <p class="price">$${event.event_price}</p>
  `;

  eventElement.appendChild(eventImage);
  eventElement.appendChild(eventContent);
  
  eventList.appendChild(eventElement);
});

    };




    let events = [];
    try {
      const response = await fetch('/api/events');
      events = await response.json();
      displayEvents(events); 
    } catch (error) {
      console.error('Error fetching events:', error);
    }

    document.getElementById('search-input').addEventListener('input', (event) => {
      const query = event.target.value.toLowerCase();
      filterAndDisplayEvents(query, getSelectedCategory());
    });

    document.querySelectorAll('.filter-button').forEach(button => {
      button.addEventListener('click', () => {
        document.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        filterAndDisplayEvents(document.getElementById('search-input').value.toLowerCase(), button.dataset.category);
      });
    });

    const filterAndDisplayEvents = (query, category) => {
      const filteredEvents = events.filter(e => {
        const matchesQuery = e.event_name.toLowerCase().includes(query) ||
                             e.category.toLowerCase().includes(query) ||
                             e.event_location.toLowerCase().includes(query);
        const matchesCategory = category === 'all' || e.category.toLowerCase() === category.toLowerCase();
        return matchesQuery && matchesCategory;
      });
      displayEvents(filteredEvents);
    };

    const getSelectedCategory = () => {
      return document.querySelector('.filter-button.active').dataset.category;
    };

    
    const userData = JSON.parse(localStorage.getItem('user'));
    if (userData) {
      const authDiv = document.getElementById('auth');
      authDiv.innerHTML = `
        <a href="dashboard/dashboard.html">MyBookings</a>
        <span>${userData.name}</span>
        <img src="/assets/profile.png" alt="Profile Picture" class="profile-pic" id="profile-pic">
        <div class="dropdown-menu" id="dropdown-menu">
          <a href="dashboard/dashboard.html">MyBookings</a>
          <a href="myEvents/myEvents.html">My Events</a>
          <a href="#" id="logout">Logout</a>
        </div>
      `;

      const profilePic = document.getElementById('profile-pic');
      const dropdownMenu = document.getElementById('dropdown-menu');

      profilePic.addEventListener('click', () => {
        dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
      });

      document.getElementById('logout').addEventListener('click', () => {
        localStorage.removeItem('user');
        location.reload();
      });

      window.addEventListener('click', (e) => {
        if (!e.target.matches('#profile-pic') && !e.target.matches('.dropdown-menu') && !e.target.matches('.dropdown-menu a')) {
          dropdownMenu.style.display = 'none';
        }
      });
    }
  });
</script>

</body>
</html>
